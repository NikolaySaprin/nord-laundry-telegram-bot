# –£–ª—É—á—à–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π WhatsApp

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –æ—Ç–≤–µ—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞–º –≤ WhatsApp –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∞—Å—å –ª–∏—à–Ω—è—è –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–∞–≤–∞—Ç–∞—Ä–∫–∏, ID —Å–æ–æ–±—â–µ–Ω–∏–π, —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π), —á—Ç–æ –∑–∞–≥—Ä–æ–º–æ–∂–¥–∞–ª–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

## –†–µ—à–µ–Ω–∏–µ

### 1. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã—Ö:

```typescript
// –£–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ Telegram (https://t.me/...)
cleanMessage = cleanMessage.replace(/https:\/\/t\.me\/[^\s\n]+/g, '');

// –£–¥–∞–ª—è–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (@username)
cleanMessage = cleanMessage.replace(/@[a-zA-Z0-9_]+/g, '');

// –£–¥–∞–ª—è–µ–º ID —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –¥—Ä—É–≥–∏–µ –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ
cleanMessage = cleanMessage.replace(/\[[^\]]+\]/g, '');
cleanMessage = cleanMessage.replace(/\([^)]*message[^)]*\)/gi, '');
cleanMessage = cleanMessage.replace(/\([^)]*thread[^)]*\)/gi, '');

// –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏ –ø—Ä–æ–±–µ–ª—ã
cleanMessage = cleanMessage.replace(/\n\s*\n/g, '\n').trim();
cleanMessage = cleanMessage.replace(/\s+/g, ' ').trim();

// –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
cleanMessage = cleanMessage.replace(/^\s*\n+|\n+\s*$/g, '');
```

### 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ª—É–∂–µ–±–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `isServiceImage()` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–∫ –∏ —Å–ª—É–∂–µ–±–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

```typescript
private isServiceImage(url: string): boolean {
  const lowerUrl = url.toLowerCase();
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–∞ –≤ URL
  const sizeMatch = url.match(/[?&]size=(\d+)/);
  if (sizeMatch) {
    const size = parseInt(sizeMatch[1]);
    if (size <= 200) { // –ê–≤–∞—Ç–∞—Ä–∫–∏ –æ–±—ã—á–Ω–æ –º–µ–Ω—å—à–µ 200px
      return true;
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã URL, —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏
  const avatarPatterns = [
    'avatar', 'profile', 'user_photo', 'chat_photo',
    'thumb', 'thumbnail', 'icon', 'emoji', 'sticker'
  ];
  
  for (const pattern of avatarPatterns) {
    if (lowerUrl.includes(pattern)) {
      return true;
    }
  }
  
  return false;
}
```

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤

```typescript
// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ–¥–∏–∞ —Ñ–∞–π–ª—ã, –µ—Å–ª–∏ –µ—Å—Ç—å (–∏—Å–∫–ª—é—á–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
if (reply.mediaUrls && reply.mediaUrls.length > 0) {
  for (const mediaUrl of reply.mediaUrls) {
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    if (this.isServiceImage(mediaUrl)) {
      console.log('‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–µ–±–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:', mediaUrl);
      continue;
    }
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –º–µ–¥–∏–∞ –ø–æ URL –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
    const mediaType = this.getMediaTypeFromUrl(mediaUrl);
    await this.sendMediaMessage(reply.targetUserId, mediaUrl, mediaType);
  }
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
```
[ID: 123] –û—Ç–≤–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ @username
https://t.me/username

[thread_id: 456] –°–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–µ–º–µ
```

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
```
–û—Ç–≤–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞

üì± –°–≤—è–∑–∞—Ç—å—Å—è –≤ Telegram: https://t.me/username
```

## –ß—Ç–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è:

### –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- ‚úÖ –°—Å—ã–ª–∫–∏ –Ω–∞ Telegram (https://t.me/...)
- ‚úÖ –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (@username)
- ‚úÖ ID —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö [ID: 123]
- ‚úÖ –ú–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –≤ —Å–∫–æ–±–∫–∞—Ö (message_id, thread_id)
- ‚úÖ –õ–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏ –ø—Ä–æ–±–µ–ª—ã
- ‚úÖ –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ

### –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã:
- ‚úÖ –ê–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ä–∞–∑–º–µ—Ä ‚â§ 200px)
- ‚úÖ –ò–∫–æ–Ω–∫–∏ –∏ —ç–º–æ–¥–∑–∏
- ‚úÖ –°—Ç–∏–∫–µ—Ä—ã
- ‚úÖ –ú–∏–Ω–∏–∞—Ç—é—Ä—ã (thumbnails)
- ‚úÖ –°–ª—É–∂–µ–±–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

1. **–°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥:**
   ```bash
   npm run build
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –Ω–∞ VPS:**
   ```bash
   pm2 restart nord-laundry-bot
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   pm2 logs nord-laundry-bot --lines 20
   ```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ WhatsApp
2. –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ–≥–æ –≤ Telegram –≥—Ä—É–ø–ø–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ WhatsApp –ø—Ä–∏—à–µ–ª —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç + —Å—Å—ã–ª–∫–∞ –Ω–∞ Telegram
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏ –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–ª—É–∂–µ–±–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
```
‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–µ–±–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: https://...
```
