#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ WhatsApp –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞ VPS

echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ WhatsApp..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–∞–ø–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
if [ ! -d ".wwebjs_auth" ]; then
    echo "‚ùå –ü–∞–ø–∫–∞ .wwebjs_auth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    echo "üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WhatsApp –±–æ—Ç –±—ã–ª –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"
    exit 1
fi

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
ARCHIVE_NAME="whatsapp_auth_${TIMESTAMP}.tar.gz"

echo "üìÅ –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤: ${ARCHIVE_NAME}"

# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤
tar -czf "${ARCHIVE_NAME}" .wwebjs_auth/

if [ $? -eq 0 ]; then
    # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞
    SIZE=$(du -h "${ARCHIVE_NAME}" | cut -f1)
    echo "‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ: ${ARCHIVE_NAME} (${SIZE})"
    echo ""
    echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞ VPS:"
    echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª ${ARCHIVE_NAME} –Ω–∞ VPS"
    echo "2. –ù–∞ VPS –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: tar -xzf ${ARCHIVE_NAME}"
    echo "3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞: chmod -R 755 .wwebjs_auth/"
    echo "4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: pm2 restart nord-laundry-bot"
    echo ""
    echo "üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ scp –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:"
    echo "scp ${ARCHIVE_NAME} root@your-vps-ip:/path/to/project/"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ö–∏–≤–∞"
    exit 1
fi
