#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –Ω–∞ VPS —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ WhatsApp
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: bash VPS_QUICK_UPDATE.sh

echo "üöÄ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ nord-laundry-bot –Ω–∞ VPS"
echo "=============================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª package.json –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

echo "üì• –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ Git..."
git pull origin main
if [ $? -ne 0 ]; then
    echo "‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ git pull, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º..."
fi
echo ""

echo "üì¶ –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)..."
npm install
echo ""

echo "üî® –®–∞–≥ 3: –°–±–æ—Ä–∫–∞ TypeScript –∫–æ–¥–∞..."
npm run build
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ!"
    exit 1
fi
echo ""

echo "üîÑ –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ PM2..."
pm2 restart nord-laundry-bot
if [ $? -ne 0 ]; then
    echo "‚ö†Ô∏è  –ë–æ—Ç –Ω–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω –≤ PM2, –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–Ω–æ–≤–æ..."
    pm2 start bot-runner.mjs --name nord-laundry-bot
    pm2 save
fi
echo ""

echo "‚è≥ –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏..."
sleep 5
echo ""

echo "üìä –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞..."
pm2 list | grep nord-laundry-bot
echo ""

echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –±–æ—Ç–∞:"
echo "=============================================="
pm2 logs nord-laundry-bot --lines 30 --nostream
echo "=============================================="
echo ""

echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üí° –ß—Ç–æ –¥–∞–ª—å—à–µ:"
echo "1. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏: pm2 logs nord-laundry-bot"
echo "2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ WhatsApp"
echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å"
echo "4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞—è–≤–∫–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –≤ Telegram –≥—Ä—É–ø–ø–µ"
echo ""
echo "üîç –î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:"
echo "   bash VPS_DEBUG_WHATSAPP.sh"
