#!/bin/bash

echo "üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏ WhatsApp..."

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
check_session() {
    echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏..."
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫—É —Å–µ—Å—Å–∏–∏
    if [ -d ".wwebjs_auth" ]; then
        echo "‚úÖ –ü–∞–ø–∫–∞ —Å–µ—Å—Å–∏–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏
        size=$(du -sh .wwebjs_auth | cut -f1)
        echo "üìä –†–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏ —Å–µ—Å—Å–∏–∏: $size"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
        last_modified=$(stat -f "%Sm" .wwebjs_auth)
        echo "üìÖ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: $last_modified"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        if [ "$(ls -A .wwebjs_auth)" ]; then
            echo "‚úÖ –ü–∞–ø–∫–∞ —Å–µ—Å—Å–∏–∏ –Ω–µ –ø—É—Å—Ç–∞—è"
            echo "üìÅ –§–∞–π–ª—ã –≤ —Å–µ—Å—Å–∏–∏:"
            ls -la .wwebjs_auth/
        else
            echo "‚ö†Ô∏è –ü–∞–ø–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—É—Å—Ç–∞—è"
        fi
    else
        echo "‚ùå –ü–∞–ø–∫–∞ —Å–µ—Å—Å–∏–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
    echo ""
    echo "üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
    if pgrep -f "node.*bot-runner" > /dev/null; then
        echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω"
        echo "üìã PID –ø—Ä–æ—Ü–µ—Å—Å–∞:"
        pgrep -f "node.*bot-runner"
    else
        echo "‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    fi
    
    echo ""
    echo "‚è∞ –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏: $(date)"
    echo "----------------------------------------"
}

# –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
if [ "$1" = "--continuous" ]; then
    echo "üîÑ –ó–∞–ø—É—Å–∫ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)..."
    echo "üí° –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"
    echo ""
    
    while true; do
        check_session
        sleep 30
    done
else
    check_session
fi
